{% extends "base.html" %}
{% block title %}Connexion{% endblock %}

{% block content %}
<div class="panel-card" style="max-width:480px;margin:48px auto;padding:24px">
    <h2 style="margin:0 0 12px 0;">Connexion</h2>
    <p style="margin:0 0 16px 0;color:#6b7280">Entrez vos identifiants pour accéder à l’application.</p>

    {# Messages flash #}
    {% with msgs = get_flashed_messages(with_categories=true) %}
    {% if msgs %}
    <ul style="padding:0;list-style:none;margin:0 0 12px 0">
        {% for cat, msg in msgs %}
        <li class="flash {{cat}}">{{ msg }}</li>
        {% endfor %}
    </ul>
    {% endif %}
    {% endwith %}

    <form method="post" action="{{ url_for('auth.login') }}">
        {# Conserve le "next" côté serveur (évite open-redirect) #}
        {% set next_url = next or request.args.get('next') %}
        {% if next_url %}
        <input type="hidden" name="next" value="{{ next_url }}">
        {% endif %}

        {# CSRF si Flask-WTF est en place #}
        {% if csrf_token is defined %}
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        {% endif %}

        <div class="field" style="margin:10px 0;">
            <label for="username">Identifiant</label>
            <input id="username" name="username" type="text" autocomplete="username" inputmode="text" required autofocus
                value="{{ request.form.get('username','') }}">
        </div>

        <div class="field" style="margin:10px 0;">
            <label for="password">Mot de passe</label>
            <input id="password" name="password" type="password" autocomplete="current-password" required>
        </div>

        <button type="submit" class="btn" style="margin-top:12px;">Se connecter</button>
    </form>
</div>
{% endblock %}